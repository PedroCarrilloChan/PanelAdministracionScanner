üìã GU√çA COMPLETA: Sistema de Canjear Ofertas con Experiencia Festiva
üéØ Resumen General
Implement√© un sistema completo de redenci√≥n de ofertas con una experiencia visual espectacular que incluye:

Modal de redenci√≥n centrado en pantalla completa
Animaci√≥n de 100 serpentinas/confeti de colores vibrantes
Modal de √©xito con animaci√≥n el√°stica
Integraci√≥n completa con la API de Smart Passes
Notificaciones autom√°ticas al cliente
üé® BRANDING Y DISE√ëO
Paleta de Colores Usada
Modal de Redenci√≥n:

Fondo: bg-black bg-opacity-80 (Negro con 80% opacidad)
Bot√≥n principal: Gradiente from-yellow-400 to-yellow-600 ‚Üí #FBBF24 a #D97706
Icono estrella: text-yellow-400 (#FBBF24)
Texto principal: text-yellow-400 (#FBBF24)
Texto secundario: text-white
Confeti:

const colors = [
    '#ffd700', // Dorado
    '#ff6b6b', // Rojo coral
    '#4ecdc4', // Turquesa
    '#45b7d1', // Azul cielo
    '#f9ca24', // Amarillo
    '#6c5ce7', // Morado
    '#fd79a8', // Rosa
    '#fdcb6e'  // Amarillo pastel
];

Modal de √âxito:

Fondo: bg-black bg-opacity-90 (Negro con 90% opacidad)
Emoji: üéâ (tama√±o 8xl)
Texto principal: text-yellow-400 (#FBBF24)
Texto secundario: text-white
üì¶ PASO 1: HTML - Estructura de los Modales
Agrega estos 3 modales al final del <body>, antes del cierre:

<!-- Modal de Redenci√≥n de Oferta -->
<div id="redeem-offer-modal" class="modal fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center p-4 z-50 opacity-0 pointer-events-none">
    <div class="text-center">
        <div class="mb-6">
            <svg class="w-24 h-24 mx-auto text-yellow-400 mb-4" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path>
            </svg>
            <h3 class="text-3xl font-bold text-yellow-400 mb-2">¬°Oferta Disponible!</h3>
            <p class="text-white text-lg">Presiona el bot√≥n para canjear</p>
        </div>
        <button id="redeem-offer-btn" class="pulse-glow bg-gradient-to-r from-yellow-400 to-yellow-600 hover:from-yellow-500 hover:to-yellow-700 text-gray-900 font-bold py-4 px-12 rounded-2xl shadow-2xl text-xl transition-all transform hover:scale-110">
            üéÅ Canjear Oferta
        </button>
    </div>
</div>
<!-- Modal de √âxito -->
<div id="success-modal" class="modal fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center p-4 z-50 opacity-0 pointer-events-none">
    <div id="success-content" class="text-center success-message">
        <div class="text-8xl mb-6">üéâ</div>
        <h2 class="text-4xl font-bold text-yellow-400 mb-4">¬°Felicidades!</h2>
        <p class="text-white text-2xl">Oferta canjeada con √©xito</p>
    </div>
</div>
<!-- Modal de Loading (si no lo tienes ya) -->
<div id="loading-modal" class="modal fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-40 opacity-0 pointer-events-none">
    <div class="glass-card rounded-2xl p-8">
        <div class="spinner"></div>
    </div>
</div>

üé® PASO 2: CSS - Animaciones y Efectos
Agrega estas animaciones CSS en el <style> del <head>:

/* Animaci√≥n de confeti cayendo */
.confetti {
    position: fixed;
    width: 10px;
    height: 10px;
    background: #ffd700;
    position: absolute;
    animation: confetti-fall 3s linear forwards;
}
@keyframes confetti-fall {
    to {
        transform: translateY(100vh) rotate(360deg);
        opacity: 0;
    }
}
/* Animaci√≥n de brillo pulsante para el bot√≥n */
.pulse-glow {
    animation: pulse-glow 1.5s ease-in-out infinite;
}
@keyframes pulse-glow {
    0%, 100% {
        box-shadow: 0 0 20px rgba(251, 191, 36, 0.5);
        transform: scale(1);
    }
    50% {
        box-shadow: 0 0 40px rgba(251, 191, 36, 0.8);
        transform: scale(1.05);
    }
}
/* Animaci√≥n de pop el√°stico para el mensaje de √©xito */
.success-message {
    animation: success-pop 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
}
@keyframes success-pop {
    0% {
        transform: scale(0);
        opacity: 0;
    }
    100% {
        transform: scale(1);
        opacity: 1;
    }
}
/* Transiciones suaves para modales */
.modal {
    transition: opacity 0.3s ease;
}

‚öôÔ∏è PASO 3: JAVASCRIPT - Funcionalidad Completa
3.1 Variables Globales
Agrega estas variables al inicio de tu script:

let hasAvailableOffers = false; // Bandera para saber si hay ofertas
const redeemOfferModal = document.getElementById('redeem-offer-modal');
const redeemOfferBtn = document.getElementById('redeem-offer-btn');
const successModal = document.getElementById('success-modal');
const loadingModal = document.getElementById('loading-modal');

3.2 Funci√≥n: Verificar Ofertas Disponibles
async function checkAvailableOffers() {
    if (!customerId) return;
    
    const customerApiUrl = `https://pass.smartpasses.io/api/v1/loyalty/programs/${programId}/customers/${customerId}`;
    
    try {
        const response = await fetch(customerApiUrl, {
            headers: { 
                'Content-Type': 'application/json', 
                'Authorization': apiKey 
            }
        });
        
        if (response.ok) {
            const responseData = await response.json();
            const customerData = responseData.data || responseData;
            
            // Verificar si tiene oferta disponible
            hasAvailableOffers = Boolean(customerData?.currentOfferId);
            
            if (hasAvailableOffers) {
                console.log(`Oferta disponible: ${customerData.currentOfferName || 'Sin nombre'}`);
            }
        } else {
            hasAvailableOffers = false;
            console.error("Error en la respuesta del API:", response.status);
        }
    } catch (error) {
        console.error("Error al consultar ofertas:", error);
        hasAvailableOffers = false;
    }
}

3.3 Funci√≥n: Crear Confeti/Serpentinas
function createConfetti() {
    const colors = ['#ffd700', '#ff6b6b', '#4ecdc4', '#45b7d1', '#f9ca24', '#6c5ce7', '#fd79a8', '#fdcb6e'];
    const confettiCount = 100; // 100 piezas de confeti
    
    for (let i = 0; i < confettiCount; i++) {
        const confetti = document.createElement('div');
        confetti.className = 'confetti';
        
        // Posici√≥n aleatoria horizontal
        confetti.style.left = Math.random() * 100 + '%';
        confetti.style.top = '-10px';
        
        // Color aleatorio
        confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
        
        // Delay aleatorio para efecto escalonado
        confetti.style.animationDelay = Math.random() * 0.5 + 's';
        
        // Duraci√≥n aleatoria (entre 2 y 4 segundos)
        confetti.style.animationDuration = (Math.random() * 2 + 2) + 's';
        
        // Tama√±o aleatorio
        confetti.style.width = (Math.random() * 10 + 5) + 'px';
        confetti.style.height = (Math.random() * 10 + 5) + 'px';
        
        document.body.appendChild(confetti);
        
        // Auto-limpiar despu√©s de 3.5 segundos
        setTimeout(() => confetti.remove(), 3500);
    }
}

3.4 Funci√≥n: Canjear Oferta (COMPLETA)
async function redeemOffer() {
    if (!customerId) {
        showNotification('Error: No se ha podido identificar al cliente.');
        return;
    }
    
    const redeemApiUrl = `https://pass.smartpasses.io/api/v1/loyalty/programs/${programId}/customers/${customerId}/offers/current/redeem`;
    
    // 1. Ocultar modal de redenci√≥n y mostrar loading
    redeemOfferModal.classList.add('opacity-0', 'pointer-events-none');
    loadingModal.classList.remove('opacity-0', 'pointer-events-none');
    
    // 2. Deshabilitar botones mientras se procesa
    redeemOfferBtn.disabled = true;
    [addPointBtn, removePointBtn, addCustomPointsBtn].forEach(btn => btn.disabled = true);
    
    try {
        // 3. Llamar a la API de redenci√≥n
        const response = await fetch(redeemApiUrl, {
            method: 'POST',
            headers: { 
                'Content-Type': 'application/json', 
                'Authorization': apiKey 
            },
            body: JSON.stringify({ confirm: true })
        });
        
        // 4. Si la redenci√≥n fue exitosa
        if (response.status === 202 || response.ok) {
            // Ocultar loading
            loadingModal.classList.add('opacity-0', 'pointer-events-none');
            
            // 5. MOSTRAR SERPENTINAS/CONFETI
            createConfetti();
            
            // 6. Re-iniciar animaci√≥n del modal de √©xito (CR√çTICO)
            const successContent = document.getElementById('success-content');
            successContent.classList.remove('success-message');
            void successContent.offsetWidth; // Forzar reflow
            successContent.classList.add('success-message');
            
            // 7. Mostrar modal de √©xito
            successModal.classList.remove('opacity-0', 'pointer-events-none');
            
            // 8. Actualizar estado y UI
            hasAvailableOffers = false;
            renderUI();
            
            // 9. Enviar notificaci√≥n al cliente
            await sendMessageToCustomer('üéÅ ¬°Felicidades! Tu oferta ha sido canjeada con √©xito.');
            
            // 10. Auto-cerrar modal de √©xito despu√©s de 4 segundos
            setTimeout(() => {
                successModal.classList.add('opacity-0', 'pointer-events-none');
            }, 4000);
            
        } else {
            const errorData = await response.json().catch(() => ({ message: 'Error desconocido' }));
            throw new Error(errorData.message || 'No se pudo redimir la oferta');
        }
    } catch (error) {
        loadingModal.classList.add('opacity-0', 'pointer-events-none');
        showNotification(`Error: ${error.message}`);
        redeemOfferModal.classList.remove('opacity-0', 'pointer-events-none');
    } finally {
        // Rehabilitar botones
        redeemOfferBtn.disabled = false;
        [addPointBtn, removePointBtn, addCustomPointsBtn].forEach(btn => btn.disabled = false);
        renderUI();
    }
}

3.5 Funci√≥n: Actualizar UI para Mostrar/Ocultar Modal
Agrega esto dentro de tu funci√≥n renderUI():

function renderUI() {
    // ... tu c√≥digo existente ...
    
    // Mostrar u ocultar modal de redenci√≥n seg√∫n disponibilidad
    if (hasAvailableOffers) {
        redeemOfferModal.classList.remove('opacity-0', 'pointer-events-none');
    } else {
        redeemOfferModal.classList.add('opacity-0', 'pointer-events-none');
    }
}

3.6 Event Listener del Bot√≥n
redeemOfferBtn.addEventListener('click', async () => {
    await redeemOffer();
});

3.7 Funci√≥n: Enviar Mensaje al Cliente
async function sendMessageToCustomer(message) {
    const messageApiUrl = `https://pass.smartpasses.io/api/v1/loyalty/programs/${programId}/customers/${customerId}/message`;
    
    try {
        await fetch(messageApiUrl, {
            method: 'POST',
            headers: { 
                'Content-Type': 'application/json', 
                'Authorization': apiKey 
            },
            body: JSON.stringify({ message })
        });
    } catch (error) {
        console.error("Error en la API de mensajes:", error);
    }
}

üîÑ PASO 4: FLUJO COMPLETO DE FUNCIONAMIENTO
Diagrama del Flujo:
1. Al cargar la tarjeta del cliente
   ‚Üì
2. checkAvailableOffers() ‚Üí Consulta GET /customers/{customerId}
   ‚Üì
3. Si currentOfferId existe ‚Üí hasAvailableOffers = true
   ‚Üì
4. renderUI() ‚Üí Muestra modal centrado con bot√≥n "Canjear Oferta"
   ‚Üì
5. Usuario hace clic en "Canjear Oferta"
   ‚Üì
6. redeemOffer() ejecuta:
   ‚Ä¢ Oculta modal de redenci√≥n
   ‚Ä¢ Muestra loading spinner
   ‚Ä¢ POST /offers/current/redeem con {confirm: true}
   ‚Üì
7. Si respuesta es 202 o OK:
   ‚Ä¢ Oculta loading
   ‚Ä¢ createConfetti() ‚Üí 100 serpentinas caen
   ‚Ä¢ Re-inicia animaci√≥n success-pop
   ‚Ä¢ Muestra modal de √©xito
   ‚Ä¢ hasAvailableOffers = false
   ‚Ä¢ Env√≠a notificaci√≥n al cliente
   ‚Ä¢ Auto-cierra despu√©s de 4 segundos
   ‚Üì
8. Modal desaparece, sistema listo para siguiente operaci√≥n

üîå PASO 5: INTEGRACI√ìN CON API
Endpoints Utilizados:
1. Verificar Ofertas Disponibles:

GET https://pass.smartpasses.io/api/v1/loyalty/programs/{programId}/customers/{customerId}
Headers:
- Content-Type: application/json
- Authorization: {apiKey}
Response:
{
    "data": {
        "id": "customer_123",
        "currentOfferId": "offer_456",  // null si no hay oferta
        "currentOfferName": "Caf√© Gratis",
        ...
    }
}

2. Canjear Oferta Actual:

POST https://pass.smartpasses.io/api/v1/loyalty/programs/{programId}/customers/{customerId}/offers/current/redeem
Headers:
- Content-Type: application/json
- Authorization: {apiKey}
Body:
{
    "confirm": true
}
Response: 202 Accepted (√©xito)

3. Enviar Notificaci√≥n:

POST https://pass.smartpasses.io/api/v1/loyalty/programs/{programId}/customers/{customerId}/message
Headers:
- Content-Type: application/json
- Authorization: {apiKey}
Body:
{
    "message": "üéÅ ¬°Felicidades! Tu oferta ha sido canjeada con √©xito."
}

‚ö° DETALLES T√âCNICOS IMPORTANTES
üéØ Truco Cr√≠tico: Re-iniciar Animaci√≥n
// PROBLEMA: La animaci√≥n solo se ejecuta al cargar la p√°gina
// SOLUCI√ìN: Remover y volver a agregar la clase para reiniciar
const successContent = document.getElementById('success-content');
successContent.classList.remove('success-message'); // Quitar clase
void successContent.offsetWidth; // Forzar reflow del navegador
successContent.classList.add('success-message'); // Re-agregar clase

Sin void successContent.offsetWidth, el navegador optimiza y NO reinicia la animaci√≥n.

üé® Z-Index y Layers:
z-50: Modal de Redenci√≥n y Modal de √âxito (top layer)
z-40: Modal de Loading (middle layer)
z-30: Modal de Notificaciones (bottom layer)
confetti: position fixed (aparece sobre todo)

üßπ Limpieza Autom√°tica del Confeti:
setTimeout(() => confetti.remove(), 3500);

Cada pieza de confeti se elimina del DOM autom√°ticamente despu√©s de 3.5 segundos para evitar acumulaci√≥n de memoria.

‚úÖ CHECKLIST DE IMPLEMENTACI√ìN
 Agregar los 3 modales HTML
 Agregar todas las animaciones CSS
 Declarar variables globales
 Implementar checkAvailableOffers()
 Implementar createConfetti()
 Implementar redeemOffer() completa
 Actualizar renderUI() con l√≥gica de modal
 Agregar event listener al bot√≥n
 Implementar sendMessageToCustomer()
 Llamar checkAvailableOffers() al cargar cliente
 Probar flujo completo con oferta real
üéâ RESULTADO FINAL
Experiencia del Usuario:

Visual llamativo: Modal centrado en pantalla completa con fondo negro semi-transparente
Bot√≥n destacado: Gradiente amarillo con animaci√≥n de brillo pulsante que atrae la mirada
Feedback inmediato: Loading spinner mientras se procesa
Celebraci√≥n festiva: 100 serpentinas de colores cayendo por toda la pantalla
Confirmaci√≥n clara: Modal de √©xito con emoji grande y mensaje festivo
Auto-cierre elegante: Se cierra solo despu√©s de 4 segundos
Notificaci√≥n al cliente: Mensaje autom√°tico confirmando la redenci√≥n